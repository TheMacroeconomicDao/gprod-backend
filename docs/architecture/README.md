# Архитектура GPROD

## Содержание

- [Обзор архитектуры](#обзор-архитектуры)
- [Стек технологий](#стек-технологий)
- [Модульная структура](#модульная-структура)
- [Взаимодействие компонентов](#взаимодействие-компонентов)
- [Шаблоны проектирования](#шаблоны-проектирования)
- [Диаграммы](#диаграммы)

## Обзор архитектуры

GPROD использует модульную архитектуру, построенную на основе фреймворка NestJS. Приложение разделено на независимые модули, каждый из которых отвечает за свою часть функциональности и следует принципам SOLID.

Центральными принципами архитектуры являются:
- **Модульность** - каждый модуль отвечает за свою часть функциональности
- **Dependency Injection** - все зависимости внедряются через конструкторы
- **Single Responsibility** - каждый класс имеет одну ответственность
- **Инкапсуляция** - внутренняя логика скрыта за публичными интерфейсами
- **Testability** - архитектура оптимизирована для удобного тестирования

## Стек технологий

Проект построен на современном стеке технологий:

- **NestJS** — модульный бэкенд-фреймворк с DI-контейнером, декораторами и TypeScript поддержкой
- **TypeScript** — строгая типизация для безопасного рефакторинга и autocomplete
- **Prisma ORM** — типобезопасный ORM с миграциями и автогенерацией типов
- **PostgreSQL** — надёжная и производительная СУБД, поддержка JSON, индексов и транзакций
- **Docker & docker-compose** — контейнеризация для разных окружений и зависимостей
- **Swagger** — автоматическая документация API с возможностью тестирования
- **JWT** — безопасная аутентификация и авторизация с refresh токенами
- **Winston** — структурированное логирование с уровнями и форматированием
- **Jest** — модульное и e2e тестирование с покрытием
- **Class-validator** — валидация входящих данных на уровне DTOs
- **Argon2** — современное хеширование паролей
- **Prometheus & Grafana** — мониторинг и визуализация метрик

## Модульная структура

### Основные модули

- **Environment Module** (`/src/common/environment`) - управление переменными окружения и конфигурацией
- **Database Module** (`/src/common/database`) - работа с базой данных через Prisma
- **Security Module** (`/src/common/security`) - централизованное управление безопасностью, JWT, guards
- **Upload Module** (`/src/common/upload`) - работа с загрузкой и управлением файлами

### Бизнес-модули

- **Users Module** (`/src/modules/users`) - управление пользователями
- **Auth Module** (`/src/modules/auth`) - аутентификация и авторизация
- **Projects Module** (`/src/modules/projects`) - управление проектами
- **Health Module** (`/src/modules/health`) - проверка здоровья системы

### Общие компоненты

- **Logger Module** - продвинутое логирование на базе Winston
- **Config Module** - управление конфигурацией приложения

## Взаимодействие компонентов

1. **Веб-клиент** отправляет запрос на API
2. **NestJS Guards** проверяют авторизацию и права доступа
3. **Controllers** принимают запрос и валидируют данные через DTO
4. **Services** реализуют бизнес-логику
5. **Prisma ORM** обеспечивает доступ к базе данных
6. **Filters** обрабатывают возможные ошибки
7. **Winston Logger** записывает все действия

## Шаблоны проектирования

В проекте используются следующие шаблоны проектирования:

- **Dependency Injection** — автоматический инжект зависимостей через NestJS DI-контейнер
- **Repository** — абстракция доступа к данным через Prisma
- **DTO** — валидация и трансформация данных на входе/выходе API
- **Guard** — защита роутов на основе ролей и JWT
- **Interceptor** — трансформация запросов/ответов
- **Filter** — централизованная обработка ошибок

## Диаграммы

_Здесь будут размещены важные диаграммы архитектуры._

### Структура модулей

```
src/
├── common/                 # Общие компоненты
│   ├── database/           # Модуль работы с БД
│   ├── environment/        # Управление окружениями
│   ├── logger/             # Логирование
│   ├── security/           # Безопасность
│   └── upload/             # Загрузка файлов
├── modules/                # Бизнес-модули
│   ├── auth/               # Аутентификация и авторизация
│   ├── users/              # Управление пользователями
│   ├── projects/           # Управление проектами
│   └── health/             # Проверка состояния
├── app.module.ts           # Корневой модуль
└── main.ts                 # Точка входа
```

## Дополнительные документы

- [Бизнес-логика](business-logic.md) - описание основной бизнес-логики приложения
- [База данных](database.md) - схема базы данных и отношения между таблицами 