#!/bin/bash

# –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –≤ Docker
# –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ –∏ —Ç–∞–π–º–µ—Ä–∞–º–∏

echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –≤ Docker..."

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
echo "üßπ –û—á–∏—â–∞–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
docker compose down

# –ó–∞–ø—É—Å–∫ unit-—Ç–µ—Å—Ç–æ–≤
echo "üîç –ó–∞–ø—É—Å–∫–∞–µ–º unit-—Ç–µ—Å—Ç—ã..."
docker compose run --rm app pnpm run test

# –ó–∞–ø—É—Å–∫ e2e-—Ç–µ—Å—Ç–æ–≤ —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º
echo "üîç –ó–∞–ø—É—Å–∫–∞–µ–º e2e-—Ç–µ—Å—Ç—ã —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º..."
docker compose run --rm app sh -c "NODE_OPTIONS=--unhandled-rejections=strict pnpm run test:e2e || true"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
echo "üßπ –û—á–∏—â–∞–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
docker compose down

echo "‚úÖ –¢–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!"
